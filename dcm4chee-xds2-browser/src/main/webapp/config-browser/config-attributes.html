<!-- Composite (Object) -->
<div ng-if="isNodeComposite()">

    <!--legend>{{schema.class}}</legend-->
    <div class="form-horizontal" ng-controller="CompositeNodeController">
        <div ng-repeat="group in groups | groupSorter">
            <fieldset>
                <legend ng-show="groups.length>1">{{group}}</legend>
                <div ng-repeat="propertySchema in schema.properties | toArray | primaryPropsOnly:doShowAllProps| filterProperties:editor.options | filter:{uiGroup:group}">

                    <div confignode="confignode[propertySchema.$key]" schema="propertySchema" parentnode="confignode"
                         index="propertySchema.$key"
                         editor="editor">
                    </div>
                </div>
            </fieldset>
        </div>

        <a href=""
           class="btn btn-default pull-right"
           ng-click="toggleShowAllProps()"
           ng-show="isShowAllTogglable">{{doShowAllProps ?
            "Show only primary "+schema.class+" properties" :
            "Show all "+schema.class+" properties..."}}
        </a>
    </div>
</div>

<div ng-class="(!noLabel ? 'form-group' : '')"
     ng-if="(schema.type == 'string' ||
     schema.type == 'integer' ||
     schema.type == 'boolean' ||
     schema.type == 'enum' ||
     (schema.type == 'array' && schema.items.type != 'object'))">

    <label class="col-sm-4 control-label"
           ng-if="!noLabel"
           data-placement="bottom-right"
           data-animation="am-fade-and-scale"
           data-html="true"
           data-delay="200"
           bs-tooltip="propertyTooltip">{{schema.title ? schema.title : index}}</label>


    <div class="col-sm-8">

        <!-- Primitives -->
        <div ng-if="((schema.type == 'string' || schema.type == 'integer') && schema.class!='Reference')">
            <input class="form-control" ng-model="parentnode[index]">
        </div>


        <!-- Boolean -->
        <div class="checkbox" ng-if="schema.type == 'boolean'">
            <input ng-model="parentnode[index]" type="checkbox">
        </div>

        <!-- enum -->
        <div ng-if="schema.type == 'enum'">
            <select ng-if="schema.enumRepresentation=='STRING'" ng-model="parentnode[index]" class="form-control"
                    ng-options="option for option in schema.enum">
            </select>
            <select ng-if="schema.enumRepresentation=='ORDINAL'" ng-model="parentnode[index]" class="form-control"
                    ng-options="option as schema.enumStrValues[option] for option in schema.enum">
            </select>
        </div>

        <!-- reference -->
        <div ng-if="(schema.type == 'string' && schema.class=='Reference')">
            <select class="form-control"
                    ng-if="schema.referencedClass=='Device'"
                    ng-model="parentnode[index]"
                    ng-options="option.ref as option.name for option in editor.deviceRefs">
            </select>
            <select class="form-control"
                    ng-if="schema.referencedClass=='Connection'"
                    ng-model="parentnode[index]"
                    ng-options="option.ref as option.name for option in editor.connectionRefs">
            </select>
        </div>


        <!-- Collections -->
        <div ng-if="(schema.type == 'array')">
            <div class="row" ng-repeat="(k, node) in confignode track by k">

                <div confignode="node"
                     schema="schema.items"
                     parentnode="confignode"
                     index="k"
                     editor="editor"
                     no-label="true">
                </div>
                <a href="" class="btn btn-info" ng-click="confignode.splice(k,1)">Delete</a>
            </div>
            <a href="" class="btn btn-info" ng-click="confignode.push('')">Add</a>
        </div>


    </div>
</div>

<!-- Object collection -->
<div ng-if="(schema.type == 'array' && schema.items.type == 'object')" ng-controller="CollectionController">

    <div class="panel panel-default">
        <div class="panel-heading">
            <h3 class="panel-title">{{schema.title!='' ? schema.title : index}}</h3>
        </div>
        <div class="panel-body">

            <div class="row">
                <div class="nice-pane-padding nice-solid-regular col-sm-3">
                    <p ng-show="isCollectionEmpty()">No items.</p>
                    <table class="table table-regular table-bordered table-hover" ng-show="!isCollectionEmpty()">
                        <thead>
                        <tr>
                            <th>Name</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="item in confignode" ng-click="selectItem(item);">
                            <td>{{getLabel(item, schema.items)}}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="col-sm-9" ng-if="selectedItemConfig">
                    <div config-node-editor
                         schema="schema.items"
                         config="selectedItemConfig"
                         editor="editor">
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Map -->
<div ng-if="(schema.type == 'Map')" ng-controller="MapController">
    <!-- Map view -->
    <a href="" ng-click="addEntry()">Add</a>
    <table class="table table-condensed smallprops">
        <tr ng-repeat="(k,node) in confignode">
            <!-- view key -->
            <td ng-show="!edited"><span class="label label-success details-header">{{k}}</span>
                <a href="" class="btn btn-default pull-right" ng-click="edited = true"><span class="icon-pencil"></span></a>
                <a href="" class="btn btn-danger close" ng-click="deleteEntry(k)">&times</a>
            </td>
            <!-- edit key -->
            <td ng-show="edited" ng-init="newkey = k">
                <input ng-model="newkey"/>
                <a class="btn btn-success" href="" ng-click="edited = !saveKey(k,newkey)">Save</a>
            </td>
            <td ng-controller="ConfigSubNodeController">
                <div confignode="node" metadata="nodeMetadata" parentnode="confignode" index="k" editor="editor"></div>
            </td>
        </tr>
    </table>
</div>

<!-- Device -->
<div ng-if="schema.type == 'Device'" ng-controller="ConfigSubNodeController">
    <span class="grey"> Device: </span>
    <button type="button" class="btn btn-default"
            ng-model="parentnode[index]" data-html="1"
            ng-options="device.deviceName as device.deviceName for device in devices"
            ng-change="editor.checkModified()"
            bs-select>
        Status <span class="caret"></span>
    </button>
</div>

